<section class="profile-page">
    <header class="profile-header">
        <div class="profile-banner"></div>

        <div class="profile-avatar-wrapper">
            <img src="{{ url_for('static', filename='images/' ~ (user.user_avatar_path if user.user_avatar_path else 'unknown.jpg')) }}"
                alt="{{ x.lans('profile_picture') }}" class="profile-avatar" />
        </div>

        <div class="profile-header-main">
            <div class="profile-header-row">
                <div>
                    <h1 class="profile-name {{ '!text-c-red' if user.user_is_blocked == 1 else '' }}">
                        {{ user.user_first_name }} {{ user.user_last_name }}
                        {% if user.user_is_blocked == 1 %}
                        <span>|| {{ x.lans("blocked") }} <i class="fa-solid fa-lock"></i></span>
                        {% endif %}
                    </h1>
                    <p class="profile-username">@{{ user.user_username }}</p>
                </div>
                {% if user.user_is_admin %}
                <div id="toggle-user-{{ user.user_pk }}">
                    {% include "__admin_toggle_user_button.html" with context %}
                </div>
                {% endif %}

                {% if not is_me %}
                {% include "__follow_button.html" %}
                {% endif %}

                {% if is_me %}
                <details class="profile-edit">
                    <summary class="btn btn-edit-profile">
                        <i class="fa fa-pencil"></i>
                        <span>{{ x.lans("edit_profile") }}</span>
                    </summary>
                    <div class="profile-edit-form">
                        <form action="{{ url_for('api_update_profile') }}" method="POST" enctype="multipart/form-data"
                            mix-post>
                            <button type="button" class="close-edit">
                                <i class="fa-solid fa-x"></i>
                            </button>

                            <label class="profile-field">
                                <span>{{ x.lans("first_name") }}</span>
                                <input type="text" name="user_first_name" value="{{ user.user_first_name }}" required />
                            </label>

                            <label class="profile-field">
                                <span>{{ x.lans("username") }}</span>
                                <input type="text" name="user_username" value="{{ user.user_username }}" required />
                            </label>

                            <label class="profile-field">
                                <span>{{ x.lans("email") }}</span>
                                <input type="email" name="user_email" value="{{ user.user_email }}" required />
                            </label>

                            <label class="profile-field">
                                <span>{{ x.lans("bio") }}</span>
                                <textarea name="user_bio" rows="3">
                                    {{ user.user_bio or "" }}
                                </textarea>
                            </label>

                            <label class="profile-field">
                                <span>{{ x.lans("avatar") }}</span>
                                <input type="file" name="user_avatar" accept="image/*" />
                                <p>{{ x.lans("upload_images_hint") }}</p>
                            </label>

                            <button type="submit" class="btn btn-save-profile">
                                {{ x.lans("save") }}
                            </button>
                        </form>

                        <form class="x-dialog__form" action="{{ url_for('api_delete_profile') }}" mix-patch>
                            <button type="button" class="btn btn-delete-profile"
                                mix-default="{{ x.lans('delete_profile') }}" mix-await="Deleting profile ..." onclick="
                                    let value = prompt('Type DELETE to confirm profile deletion:');
                                    if (value === 'DELETE') {
                                        this.closest('form').requestSubmit();
                                    } else {
                                        alert('Profile deletion cancelled');
                                    }
                                ">
                                {{ x.lans("delete_profile") }}
                            </button>
                        </form>
                    </div>
                </details>
                {% endif %}
            </div>

            {% if user.user_bio %}
            <p id="profile_bio" class="profile-bio">{{ user.user_bio }}</p>
            {% endif %}

            <div class="profile-meta">
                <span>
                    <i class="fa fa-calendar"></i>
                    {{ x.lans("joined") }} {{ user.user_created_at|default("January 2024") }}
                </span>
            </div>

            <div class="profile-stats">
                <span><strong>123</strong> {{ x.lans("following") }}</span>
                <span><strong>456</strong> {{ x.lans("followers") }}</span>
            </div>
        </div>
    </header>

    <div class="profile-tabs">
        <button class="profile-tab active">{{ x.lans("posts") }}</button>
        <button class="profile-tab" disabled>{{ x.lans("replies") }}</button>
        <button class="profile-tab" disabled>{{ x.lans("media") }}</button>
        <button class="profile-tab" disabled>{{ x.lans("likes") }}</button>
    </div>

    <section id="posts" class="profile-timeline">
        {% for tweet in tweets: %}
        {% include "_tweet.html" %}
        {% else %}
        <p class="profile-empty-state">{{ x.lans("empty_state") }}</p>
        {% endfor %}
    </section>
</section>