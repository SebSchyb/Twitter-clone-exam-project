{# templates/_profile.html #}

<section class="profile-page">
    <header class="profile-header">
        <div class="profile-banner"></div>

        <div class="profile-avatar-wrapper">
            <img src="{{ url_for('static', filename='images/' ~ (user.user_avatar_path if user.user_avatar_path else 'unknown.jpg')) }}"
                alt="Profile picture" class="profile-avatar" />
        </div>

        <div class="profile-header-main">
            <div class="profile-header-row">
                <div>
                    <h1 class="profile-name {{ '!text-c-red' if user.user_is_blocked == 1 else '' }}">
                        {{ user.user_first_name }} {{ user.user_last_name }} {%
                        if user.user_is_blocked ==1 %}
                        <span>|| BLOCKED <i class="fa-solid fa-lock"></i></span>
                        {%endif%}
                    </h1>
                    <p class="profile-username">@{{ user.user_username }}</p>
                </div>
                {% if user.user_is_admin%}
                <div id="toggle-user-{{ user.user_pk }}">
                    {% include "__admin_toggle_user_button.html" with context %}
                </div>
                {%endif%} {% if not is_me %} {% include "__follow_button.html"%}
                {%endif%} {% if is_me %}
                <details class="profile-edit">
                    <summary class="btn btn-edit-profile">
                        <i class="fa fa-pencil"></i>
                        <span>Edit profile</span>
                    </summary>
                    <div class="profile-edit-form">
                        <form action="{{ url_for('api_update_profile') }}" method="POST" enctype="multipart/form-data"
                            mix-post>
                            <button type="button" class="close-edit">
                                <i class="fa-solid fa-x"></i>
                            </button>
                            <label class="profile-field">
                                <span>First name</span>
                                <input type="text" name="user_first_name" value="{{ user.user_first_name }}" required />
                            </label>

                            <label class="profile-field">
                                <span>Username</span>
                                <input type="text" name="user_username" value="{{ user.user_username }}" required />
                            </label>

                            <label class="profile-field">
                                <span>Email</span>
                                <input type="email" name="user_email" value="{{ user.user_email }}" required />
                            </label>

                            <label class="profile-field">
                                <span>Bio</span>
                                <textarea name="user_bio" rows="3">
{{ user.user_bio or "" }}</textarea>
                            </label>

                            <label class="profile-field">
                                <span>Avatar</span>
                                <input type="file" name="user_avatar" accept="image/*" />
                                <p>Please upload images under 4 MB in JPG, JPEG, PNG, or GIF format</p>
                            </label>

                            <button type="submit" class="btn btn-save-profile">
                                Save
                            </button>
                        </form>
                        <form class="x-dialog__form" action="{{ url_for('api_delete_profile') }}" mix-post>
                            <button type="button" class="btn btn-delete-profile" mix-default="Delete profile"
                                mix-await="Deleting profile ..." onclick="
                                    let value = prompt('Type DELETE to confirm profile deletion:');
                                    if (value === 'DELETE') {
                                        this.closest('form').requestSubmit();
                                    } else {
                                        alert('Profile deletion cancelled');
                                    }
                                ">
                                Delete profile
                            </button>
                        </form>
                    </div>
                </details>
                {%endif%}
            </div>

            {% if user.user_bio %}
            <p id="profile_bio" class="profile-bio">{{ user.user_bio }}</p>
            {% endif %}

            <!-- falske tabs, bare sÃ¥ det ser rigtigt flot ud -->
            <div class="profile-meta">
                <span>
                    <i class="fa fa-calendar"></i>
                    Joined {{ user.user_created_at|default("January 2024") }}
                </span>
            </div>

            <div class="profile-stats">
                <span><strong>123</strong> Following</span>
                <span><strong>456</strong> Followers</span>
            </div>
        </div>
    </header>

    <div class="profile-tabs">
        <button class="profile-tab active">Posts</button>
        <button class="profile-tab" disabled>Replies</button>
        <button class="profile-tab" disabled>Media</button>
        <button class="profile-tab" disabled>Likes</button>
    </div>

    <section id="posts" class="profile-timeline">
        {% for tweet in tweets: %} {% include "_tweet.html" %} {% else %}
        <p class="profile-empty-state">You haven't posted anything yet.</p>
        {% endfor %}
    </section>
</section>